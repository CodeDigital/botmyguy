{"version":3,"sources":["../src/providerFactory.ts"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEM,SAAA,sCAAA,CAAiD,GAAjD,EAA4D;AAChE,SAAO,CAAC,IAAI,QAAJ,CAAa,kBAAb,CAAR;AACD;;AAEK,SAAA,YAAA,CAAuB,IAAvB,EAAuE,OAAvE,EAA0F;AAC9F;AACA,MAAI,OAAO,IAAP,KAAgB,QAApB,EAA8B;AAC5B,UAAM,oCAAS,yCAAT,EAAoD,4CAApD,CAAN;AACD;;AAED,QAAM,eAAe,QAAQ,YAA7B;AACA,QAAM,WAAW,KAAK,QAAtB;;AACA,UAAQ,QAAR;AACE,SAAK,QAAL;AACE,YAAM,gBAAgB,IAAtB;AACA,YAAM,QAAQ,CAAC,cAAc,OAAd,GAAwB,QAAQ,GAAR,CAAY,QAAZ,IAAwB,QAAQ,GAAR,CAAY,YAA5D,GAA2E,IAA5E,KAAqF,cAAc,KAAjH;;AACA,UAAI,SAAS,IAAb,EAAmB;AACjB,eAAO,KAAI,gCAAJ,EAAmB,aAAnB,EAAkC,OAAlC,EAA2C,YAA3C,CAAP;AACD,OAFD,MAGK;AACH,eAAO,KAAI,8CAAJ,EAA0B,aAA1B,EAAyC,OAAzC,EAAkD,KAAlD,EAAyD,YAAzD,CAAP;AACD;;AAEH,SAAK,IAAL;AACA,SAAK,QAAL;AACE,aAAO,KAAI,kCAAJ,EAAoB;AACzB,kBAAU,SADe;AAEzB,aAAK,oDAAyB,IAAzB,CAFoB;AAGzB,iBAAU,KAAuB,OAAvB,IAAkC;AAHnB,OAApB,EAIJ,OAJI,EAIK,aAAa;AAAS;AAJ3B,OAAP;;AAMF,SAAK,SAAL;AACE,YAAM,UAAU,IAAhB;AACA,aAAO,KAAI,kCAAJ,EAAoB,OAApB,EAA6B,OAA7B,EAAsC,QAAQ,uBAAR,KAAoC,KAApC,IAA6C,uCAAuC,QAAQ,GAA/C,CAAnF,CAAP;;AAEF,SAAK,SAAL;AACE,aAAO,KAAI,kCAAJ,EAAoB,IAApB,EAA4C,YAA5C,CAAP;;AAEF;AACE,YAAM,oCAAS,yBAAyB,QAAQ,EAA1C,EAA8C,kCAA9C,CAAN;AA3BJ;AA6BD","sourcesContent":["import { AllPublishOptions, BaseS3Options, BintrayOptions, GenericServerOptions, getS3LikeProviderBaseUrl, GithubOptions, newError, PublishConfiguration } from \"builder-util-runtime\"\nimport { AppUpdater } from \"./AppUpdater\"\nimport { BintrayProvider } from \"./BintrayProvider\"\nimport { GenericProvider } from \"./GenericProvider\"\nimport { GitHubProvider } from \"./GitHubProvider\"\nimport { PrivateGitHubProvider } from \"./PrivateGitHubProvider\"\n\nexport function isUrlProbablySupportMultiRangeRequests(url: string): boolean {\n  return !url.includes(\"s3.amazonaws.com\")\n}\n\nexport function createClient(data: PublishConfiguration | AllPublishOptions, updater: AppUpdater) {\n  // noinspection SuspiciousTypeOfGuard\n  if (typeof data === \"string\") {\n    throw newError(\"Please pass PublishConfiguration object\", \"ERR_UPDATER_INVALID_PROVIDER_CONFIGURATION\")\n  }\n\n  const httpExecutor = updater.httpExecutor\n  const provider = data.provider\n  switch (provider) {\n    case \"github\":\n      const githubOptions = data as GithubOptions\n      const token = (githubOptions.private ? process.env.GH_TOKEN || process.env.GITHUB_TOKEN : null) || githubOptions.token\n      if (token == null) {\n        return new GitHubProvider(githubOptions, updater, httpExecutor)\n      }\n      else {\n        return new PrivateGitHubProvider(githubOptions, updater, token, httpExecutor)\n      }\n\n    case \"s3\":\n    case \"spaces\":\n      return new GenericProvider({\n        provider: \"generic\",\n        url: getS3LikeProviderBaseUrl(data),\n        channel: (data as BaseS3Options).channel || null\n      }, updater, provider === \"spaces\" /* https://github.com/minio/minio/issues/5285#issuecomment-350428955 */)\n\n    case \"generic\":\n      const options = data as GenericServerOptions\n      return new GenericProvider(options, updater, options.useMultipleRangeRequest !== false && isUrlProbablySupportMultiRangeRequests(options.url))\n\n    case \"bintray\":\n      return new BintrayProvider(data as BintrayOptions, httpExecutor)\n\n    default:\n      throw newError(`Unsupported provider: ${provider}`, \"ERR_UPDATER_UNSUPPORTED_PROVIDER\")\n  }\n}"],"sourceRoot":""}
