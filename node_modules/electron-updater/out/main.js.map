{"version":3,"sources":["../src/main.ts"],"names":[],"mappings":"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","sourcesContent":["import { CancellationToken, PackageFileInfo, ProgressInfo, UpdateFileInfo, UpdateInfo } from \"builder-util-runtime\"\nimport { EventEmitter } from \"events\"\nimport { URL } from \"url\"\nimport { AppUpdater } from \"./AppUpdater\"\nimport { LoginCallback } from \"./electronHttpExecutor\"\n\nexport { AppUpdater, NoOpLogger } from \"./AppUpdater\"\nexport { UpdateInfo }\nexport { CancellationToken } from \"builder-util-runtime\"\nexport { Provider } from \"./Provider\"\n\n// autoUpdater to mimic electron bundled autoUpdater\nlet _autoUpdater: any\n\n// required for jsdoc\nexport declare const autoUpdater: AppUpdater\n\nfunction _load_autoUpdater(): AppUpdater {\n  // tslint:disable:prefer-conditional-expression\n  if (process.platform === \"win32\") {\n    _autoUpdater = new (require(\"./NsisUpdater\").NsisUpdater)()\n  }\n  else if (process.platform === \"darwin\") {\n    _autoUpdater = new (require(\"./MacUpdater\").MacUpdater)()\n  }\n  else {\n    _autoUpdater = new (require(\"./AppImageUpdater\").AppImageUpdater)()\n  }\n  return _autoUpdater\n}\n\nObject.defineProperty(exports, \"autoUpdater\", {\n  enumerable: true,\n  get: () => {\n    return _autoUpdater || _load_autoUpdater()\n  }\n})\n\nexport interface ResolvedUpdateFileInfo {\n  readonly url: URL\n  readonly info: UpdateFileInfo\n\n  packageInfo?: PackageFileInfo\n}\n\n// due to historical reasons for windows we use channel name without platform specifier\nexport function getDefaultChannelName() {\n  return `latest${getChannelFilePrefix()}`\n}\n\nfunction getChannelFilePrefix() {\n  const currentPlatform = getCurrentPlatform()\n  if (currentPlatform === \"linux\") {\n    const arch = process.env.TEST_UPDATER_ARCH || process.arch\n    const archSuffix = arch === \"x64\" ? \"\" : `-${arch}`\n    return \"-linux\" + archSuffix\n  }\n  else {\n    return currentPlatform === \"darwin\" ? \"-mac\" : \"\"\n  }\n}\n\nexport function getCustomChannelName(channel: string) {\n  return `${channel}${getChannelFilePrefix()}`\n}\n\nexport function getCurrentPlatform() {\n  return process.env.TEST_UPDATER_PLATFORM || process.platform\n}\n\nexport function isUseOldMacProvider() {\n  // getCurrentPlatform() === \"darwin\"\n  return false\n}\n\nexport function getChannelFilename(channel: string) {\n  return `${channel}.yml`\n}\n\nexport interface UpdateCheckResult {\n  readonly updateInfo: UpdateInfo\n\n  readonly downloadPromise?: Promise<Array<string>> | null\n\n  readonly cancellationToken?: CancellationToken\n\n  /** @deprecated */\n  readonly versionInfo: UpdateInfo\n}\n\nexport type UpdaterEvents = \"login\" | \"checking-for-update\" | \"update-available\" | \"update-cancelled\" | \"download-progress\" | \"update-downloaded\" | \"error\"\n\nexport const DOWNLOAD_PROGRESS: UpdaterEvents = \"download-progress\"\nexport const UPDATE_DOWNLOADED: UpdaterEvents = \"update-downloaded\"\n\nexport type LoginHandler = (authInfo: any, callback: LoginCallback) => void\n\nexport class UpdaterSignal {\n  constructor(private emitter: EventEmitter) {\n  }\n\n  /**\n   * Emitted when an authenticating proxy is [asking for user credentials](https://github.com/electron/electron/blob/master/docs/api/client-request.md#event-login).\n   */\n  login(handler: LoginHandler) {\n    addHandler(this.emitter, \"login\", handler)\n  }\n\n  progress(handler: (info: ProgressInfo) => void) {\n    addHandler(this.emitter, DOWNLOAD_PROGRESS, handler)\n  }\n\n  updateDownloaded(handler: (info: UpdateInfo) => void) {\n    addHandler(this.emitter, UPDATE_DOWNLOADED, handler)\n  }\n\n  updateCancelled(handler: (info: UpdateInfo) => void) {\n    addHandler(this.emitter, \"update-cancelled\", handler)\n  }\n}\n\nconst isLogEvent = false\n\nfunction addHandler(emitter: EventEmitter, event: UpdaterEvents, handler: (...args: Array<any>) => void) {\n  if (isLogEvent) {\n    emitter.on(event, (...args: Array<any>) => {\n      console.log(\"%s %s\", event, args)\n      handler.apply(null, args)\n    })\n  }\n  else {\n    emitter.on(event, handler)\n  }\n}\n\nexport interface Logger {\n  info(message?: any): void\n\n  warn(message?: any): void\n\n  error(message?: any): void\n\n  debug?(message: string): void\n}\n\n// if baseUrl path doesn't ends with /, this path will be not prepended to passed pathname for new URL(input, base)\n/** @internal */\nexport function newBaseUrl(url: string) {\n  const result = new URL(url)\n  if (!result.pathname.endsWith(\"/\")) {\n    result.pathname += \"/\"\n  }\n  return result\n}\n\n// addRandomQueryToAvoidCaching is false by default because in most cases URL already contains version number,\n// so, it makes sense only for Generic Provider for channel files\n/** @internal */\nexport function newUrlFromBase(pathname: string, baseUrl: URL, addRandomQueryToAvoidCaching: boolean = false): URL {\n  const result = new URL(pathname, baseUrl)\n  const hasSearch = result.search != null && result.search.length !== 0\n  // search is not propagated (search is an empty string if not specified)\n  if (!hasSearch && baseUrl.search) {\n    result.search = baseUrl.search\n  }\n  if (addRandomQueryToAvoidCaching && !hasSearch) {\n    result.search = `noCache=${Date.now().toString(32)}`\n  }\n  return result\n}"],"sourceRoot":""}
